<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
		<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Siyakhula Living Lab Health Information Resource</title>
		<link rel="stylesheet" type="text/css" href="../resources/js/font-awesome/css/font-awesome.min.css">
		<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../resources//css/jquery.dataTables.css">
		<link rel="stylesheet" type="text/css" href="../resources/js/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="../resources/js/jquery-ui/css/ui-lightness/jquery-ui-1.9.2.custom.css">
		<link rel="stylesheet" type="text/css" href="../resources/css/toastr.css">
		<link rel="stylesheet" type="text/css" href="../resources/css/style.css">
		<link rel="stylesheet" type="text/css" href="../resources/css/simple.css">
	</head>
	<body>
		<div class="modal fade" id="modal_dialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title"></h4>
					</div>
					<div class="modal-body"></div>
					<div id="modal-footer" class="modal-footer hidden"></div>
				</div>
			</div>
		</div>
		<header>
			<div id="header">
				<section id="top" class="navbar navbar-inverse nav-justified navbar-fixed-top bs-docs-nav" role="banner" id="banner">
					<div class="container">
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul id="navigation" class="nav navbar-nav">
								<li id="home"><a href="../home/home.html"><i class="fa fa-home fa-fw"></i> <strong lang="en">HOME</strong></a></li>
								<li id="topics"><a href="../topic/topic.html"><i class="fa fa-comment fa-fw"></i> <strong lang="en">TOPICS</strong></a></li>
								<li id="news"><a href="../news/news.html"><i class="fa fa-globe fa-fw"></i> <strong lang="en">NEWS</strong></a></li>
								<li class="active" id="facilities-services"><a href="#"><i class="fa fa-medkit fa-fw"></i> <strong lang="en">SERVICES</strong></a></li>
								<li id="events"><a href="../event/events.html"><i class="fa fa-calendar fa-fw"></i> <strong lang="en">EVENTS</strong><span class="badge pull-right" id="events-number"></span></a></li>
								<li>
									<form id="frmUserLogin" class="navbar-form">
										<div class="form-group">
											<input type="text" name="loginName" id="loginName" class="form-control" placeholder="Username">
										</div>
										<div class="form-group">
											<input type="password" name="passcode" id="passcode" class="form-control" placeholder="Password">
										</div>
										<button type="submit" id="btnUserLogin" class="btn btn-primary">Log In</button>
									</form>
								</li>
							</ul>
							<ul class="nav navbar-nav navbar-right">
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-language"></i><b class="caret"></b></a>
									<ul class="dropdown-menu" style="background-color: black;">
										<li><a href="#lang-en" onclick="window.lang.change('en'); return false;">Switch to English</a></li>
										<li><a href="#lang-en" onclick="window.lang.change('xh'); return false;">Switch to Xhosa</a></li>
									</ul>
								</li>
							</ul>
						</div>			
					</div>
				</section>
				<section id="news-ticker">
					<div class="container">
						<ul id="js-news" class="js-hidden"></ul>
					</div>
				</section>
			</div>
		</header>
		<div id="factlity-list" class="facility-service container">
			<div class="table-responsive">
				<table id="tblFacilities" class="table table-striped table-hover table-highlight table-checkable">
					<thead>
						<tr>
							<th>NAME</th>
							<th>TYPE</th>
							<th>PROVINCE</th>
							<th>DISTRICT</th>					
							<th>MUNICIPALITY</th>
							<th>VILLAGE</th>
							<th>ACTIONS</th>
						</tr>
					</thead>
					<tbody></tbody>
					<tfoot>
						<tr>
							<th><input class="form-control input-sm show" type="text" placeholder="Name"></th>
							<th><input class="form-control input-sm show" type="text" placeholder="Type"></th>
							<th><input class="form-control input-sm show" type="text" placeholder="Province"></th>
							<th><input class="form-control input-sm show" type="text" placeholder="District"></th>
							<th><input class="form-control input-sm show" type="text" placeholder="Municipality"></th>
							<th><input class="form-control input-sm show" type="text" placeholder="Village"></th>
							<th><input class="form-control input-sm hide" type="text" placeholder=""></th>
						</tr>
					</tfoot>
				</table>
			</div>
		</div>
		<div class="facility-service container"><section id="section-services"></section></div>
		<script type="text/javascript" src="../resources/js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="../resources/js/jquery-ui/js/jquery-ui-1.9.2.custom.min.js"></script>
		<script type="text/javascript" src="../resources/js/bootstrap/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="../resources/js/DataTables-1.9.4/media/js/jquery.dataTables.min.js"></script>
		<script type="text/javascript" src="../resources/js/DT_bootstrap.js"></script>
		<script type="text/javascript" src="../resources/js/jquery.tableCheckable.js"></script>
		<script type="text/javascript" src="../resources/js/paging.js"></script>
		<script type="text/javascript" src="../resources/js/jquery.validate.min.js"></script>
		<script type="text/javascript" src="../resources/js/sha256.js"></script>
		<script type="text/javascript" src="../resources/js/enc-base64-min.js"></script>
		<script type="text/javascript" src="../resources/js/toastr.js"></script>
		<script type="text/javascript" src="../resources/js/jquery-lang.js" charset="utf-8"></script>
		<script type="text/javascript" src="../resources/js/nonDynamic.js" charset="utf-8"></script>
		<script type="text/javascript" src="../resources/js/jquery.cookie.js"></script>
		<script type="text/javascript" src="../resources/js/store.js"></script>
		<script type="text/javascript" src="../resources/js/util.js"></script>
		<script type="text/javascript" src="../resources/js/messenger.js"></script>
		<script type="text/javascript">
			/* Create language switcher instance and set default language to en */
			window.lang = new Lang('en');
		
			$(document).ready(function () {
				var padding = "../"
				get(padding, 'service/facility', function(data, error) {
					if (!error) {
						$('.facility-service:visible').hide();
				    	$('.facility-service:first').show();
				    	var facilityList = data instanceof Array ? data : [data];
						$.each(facilityList, function(index, facility) {
							$('#tblFacilities tbody').append(
									'<tr id="tr-' + facility.id + '">' +
									'<td>' + facility.name + '</td>' +
									'<td>' + facility.type + '</td>' +
									'<td>' + facility.address.province + '</td>' +
									'<td>' + facility.address.district + '</td>' +
									'<td>' + facility.address.municipality + '</td>' +
									'<td>' + facility.address.village + '</td>' +
									'<td class="actions"><a href="#" id="service-' + facility.id + '"><i title="List services" class="fa fa-medkit fa-1x"></i></a></td>' +
								'</tr>'
							);
							$('#service-' + facility.id).click(function() {
								get(padding, 'service/' + facility.id, function(data, error) {
									if (!error) {
										$('.facility-service:visible').hide();
								    	$('.facility-service:last').show();
								    	$('#section-services').empty();
								    	var serviceList = data instanceof Array ? data : [data];
										$.each(serviceList, function(index, service) {
											$('#section-services').append(
												'<article>' +
													'<div><h3>'+service.name+'</h3></div>' +
													'<div>'+service.description+'</div>' +
												'</article>'
											);
										});
										$('article').readmore({
											lessLink: '<a href="#">Read Less</a>'
										});
									} else {
										toastr.error("Error getting a service");
									}
								});
							});
						});
					    
						$('#tblFacilities').dataTable( {
						    "bRetrieve": true,
					    	"sDom": "<'row dt-rt'<'col-sm-6'l><'col-sm-6'f>r>t<'row dt-rt'<'col-sm-6'i><'col-sm-6'p>>",
					        'sPaginationType': 'bootstrap',
							'aoColumnDefs': [
							                 { "bSortable": false, "aTargets": [ 6] }
							],
					        "aaSorting": [[2, 'desc']],
					        "iDisplayLength": 10
					    });
					    
						$('#tblFacilities_filter input').prop ('placeholder', 'Search...');
					    
					    $('tfoot input').keyup(function() {
					    	oTable.fnFilter(this.value, $('tfoot input').index(this));
					    });
						
						$('#checkall').on('ifChecked', function(event){
							$('.icheck-input').iCheck('check');
						});
						
						$('#checkall').on('ifUnchecked', function(event){
							$('.icheck-input').iCheck('uncheck');
						});
					} else {
						toastr.error("Error getting facilities")
					}
				})
				
				// Submit form on enter
				$('input').on('keydown', function (event) {
				  if (event.keyCode === 13)
				    $('#btnUserLogin').click()
				})
				
				$('#btnUserLogin').click(function () {
					$('#frmUserLogin').validate({
						rules: {
							loginName: 'required',
							passcode : 'required'
						},
						messages: {
							loginName: '',
							passcode: ''
						},
						submitHandler: function() {
							login($('#loginName').val().trim(),
								$('#passcode').val().trim(),
								function(response, error) {
									if (!error) {
										if (response.profileComplete) {
											window.location = 'index.html';
										} else {
											window.location = '../user/update-profile.html';
										}
									} else {
										console.log(error);
										toastr.error(error.responseJSON.applicationMessage);
									}
								}
							)
						},
						invalidHandler: function(event, validator) {
							displayFormInputError(event, validator);
						}
					});
				});				
			});
			
		</script>
	</body>
</html>